<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudEase Admin - Gestão Total</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="css/admin-panel.css?v=2.1"> <!-- Novo CSS do Admin v2.1 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="admin-body">
    
    <!-- Admin Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <span style="font-size: 20px; font-weight: bold; color: white;">CloudEase</span>
            <span class="badge-admin">ADMIN</span>
        </div>
        <nav class="admin-nav">
            <a href="#" class="nav-item active" onclick="switchTab('dashboard', this)"><i class="fas fa-home"></i> Visão Geral</a>
            <a href="#" class="nav-item" onclick="switchTab('support', this)"><i class="fas fa-headset"></i> Suporte & Chat <span class="badge-counter" id="badge-tickets" style="display:none">0</span></a>
            <a href="#" class="nav-item" onclick="switchTab('users', this)"><i class="fas fa-users"></i> Usuários</a>
            <a href="#" class="nav-item" onclick="switchTab('finance', this)"><i class="fas fa-chart-line"></i> Financeiro</a>
            <a href="#" class="nav-item" onclick="switchTab('notifications', this)"><i class="fas fa-bell"></i> Avisos</a>
            <a href="#" class="nav-item" onclick="switchTab('team', this)"><i class="fas fa-user-shield"></i> Time</a>
        </nav>
        <div class="sidebar-footer">
            <div style="padding: 0 16px; margin-bottom: 10px; color: #64748b; font-size: 11px;">Módulo Admin v2.1</div>
            <a href="dashboard.html" class="nav-item"><i class="fas fa-arrow-left"></i> Voltar ao App</a>
        </div>
    </aside>

    <main class="admin-main">
        <header class="admin-topbar">
            <h2 id="page-title">Visão Geral</h2>
            <div class="user-profile">
                <!-- <span>Admin</span> -->
                <div class="avatar"><i class="fas fa-user"></i></div>
            </div>
        </header>

        <div class="admin-content">
            <!-- TAB: DASHBOARD -->
            <section id="tab-dashboard" class="admin-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Receita Mensal</h3>
                        <div class="value" id="dash-revenue">R$ 0,00</div>
                        <div class="trend positive"><i class="fas fa-arrow-up"></i> Estimado</div>
                    </div>
                    <div class="stat-card">
                        <h3>Novos Usuários</h3>
                        <div class="value" id="dash-users">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Chamados Abertos</h3>
                        <div class="value" id="dash-tickets">0</div>
                    </div>
                     <div class="stat-card">
                        <h3>Faturas Atrasadas</h3>
                        <div class="value" id="dash-overdue">0</div>
                    </div>
                </div>
                <div class="charts-row">
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="usersChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- TAB: SUPPORT -->
            <section id="tab-support" class="admin-section" style="display:none;">
                <div class="support-layout">
                    <div class="ticket-list" id="ticket-list">
                        <!-- Items injected by JS -->
                        <div style="padding:20px; text-align:center;">Carregando chamados...</div>
                    </div>
                    <div class="ticket-detail" id="ticket-detail-view">
                        <div class="empty-state"><i class="fas fa-inbox" style="font-size:48px; margin-bottom:16px;"></i><br>Selecione um chamado para visualizar a conversa</div>
                    </div>
                </div>
            </section>

            <!-- TAB: USERS -->
            <section id="tab-users" class="admin-section" style="display:none;">
                <div class="stat-card" style="margin-bottom:20px;">
                    <table class="admin-table" style="width:100%;">
                        <thead><tr><th>Nome</th><th>Email</th><th>Status</th><th>Último login</th></tr></thead>
                        <tbody id="admin-users-tbody"><tr><td colspan="4">Carregando...</td></tr></tbody>
                    </table>
                </div>
            </section>

            <!-- TAB: FINANCE -->
            <section id="tab-finance" class="admin-section" style="display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                    <h3>Gestão Financeira</h3>
                    <button onclick="runMonthlyBilling()" class="btn-primary" style="background:#10b981;"><i class="fas fa-sync"></i> Processar Cobranças</button>
                </div>
                
                <div class="stats-grid">
                   <div class="stat-card">
                       <h4>Pagantes Ativos</h4>
                       <span id="finance-paying-users" style="font-size: 24px; font-weight: bold; color: #10b981;">-</span>
                   </div>
                   <div class="stat-card">
                       <h4>Atrasados</h4>
                       <span id="finance-overdue-users" style="font-size: 24px; font-weight: bold; color: #ef4444;">-</span>
                   </div>
                   <div class="stat-card">
                       <h4>Previsão Receita</h4>
                       <span id="finance-forecast" style="font-size: 24px; font-weight: bold; color: #4f46e5;">-</span>
                   </div>
                </div>

                <h3>Faturas Recentes</h3>
                <div class="stat-card">
                    <table class="admin-table" style="width:100%;">
                        <thead><tr><th>#</th><th>Cliente</th><th>Plano</th><th>Valor</th><th>Vencimento</th><th>Status</th><th>Ações</th></tr></thead>
                        <tbody id="admin-invoices-tbody"><tr><td colspan="7">Carregando...</td></tr></tbody>
                    </table>
                </div>
            </section>

             <!-- TAB: NOTIFICATIONS -->
            <section id="tab-notifications" class="admin-section" style="display:none;">
                <h3>Avisos e Notificações do Sistema</h3>
                <p>Envie atualizações importantes que aparecerão no dashboard de todos os usuários.</p>
                <div class="stat-card" style="margin-bottom: 20px; padding: 24px;">
                    <h4>Criar Novo Aviso</h4>
                    <div style="display:flex; gap:12px; margin-top:12px;">
                        <input type="text" id="announcement-title" placeholder="Título (ex: Manutenção Programada)" style="flex:1; padding:10px; border:1px solid #e2e8f0; border-radius:6px;">
                        <select id="announcement-type" style="padding:10px; border:1px solid #e2e8f0; border-radius:6px;">
                            <option value="info">Informação (Azul)</option>
                            <option value="warning">Aviso (Amarelo)</option>
                            <option value="error">Crítico (Vermelho)</option>
                            <option value="success">Sucesso (Verde)</option>
                        </select>
                    </div>
                    <textarea id="announcement-msg" placeholder="Mensagem detalhada..." style="width:100%; margin-top:12px; padding:10px; border:1px solid #e2e8f0; border-radius:6px; height:80px;"></textarea>
                    <button onclick="postAnnouncement()" class="btn-primary" style="margin-top:12px;">Publicar Aviso</button>
                </div>
                
                <h3>Avisos Ativos</h3>
                <div id="active-announcements">
                    <!-- Loaded via JS -->
                </div>
            </section>

             <!-- TAB: TEAM -->
            <section id="tab-team" class="admin-section" style="display:none;">
                <h3>Gestão do Time e Permissões</h3>
                <div class="stat-card">
                    <p>Funcionalidade em desenvolvimento. Use o script de setup para promover admins por enquanto.</p>
                    <div style="padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <strong>Admin Atual:</strong> <span id="current-admin-email">-</span>
                    </div>
                </div>
            </section>
            
        </div>
    </main>

    <script src="js/admin.js?v=2.2"></script>
</body>
</html>

